{"paragraphs":[{"text":"%md\n# STQD 6324 Data Management Sem 2\n### Muhammad Zuhair Afham Bin Mohd Nasir (P153944)","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>STQD 6324 Data Management Sem 2</h1>\n<h3>Muhammad Zuhair Afham Bin Mohd Nasir (P153944)</h3>\n"}]},"apps":[],"jobName":"paragraph_1752396619307_-1240484925","id":"20250601-074543_2144772667","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:441"},{"text":"%md\n### This Project 3 using the u.user file from the Movielens 100k Dataset from https://grouplens.org/datasets/movielens/, which to explore insisghts.","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>This Project 3 using the u.user file from the Movielens 100k Dataset from https://grouplens.org/datasets/movielens/, which to explore insisghts.</h3>\n"}]},"apps":[],"jobName":"paragraph_1752396619308_-1242408670","id":"20250713-083744_1327774111","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:442"},{"text":"%md\n#### Download file to a local temp folder using Putty","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Download file to a local temp folder using Putty</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619308_-1242408670","id":"20250601-095933_900818063","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:443"},{"text":"%sh\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.user -O /tmp/u.user\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\necho \"Downloaded ml-100k dataset!\"","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-07-13 08:38:10--  http://media.sundog-soft.com/hadoop/ml-100k/u.user\nResolving media.sundog-soft.com (media.sundog-soft.com)... 16.182.97.185, 52.216.9.27, 3.5.25.154, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|16.182.97.185|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 22628 (22K) [text/plain]\nSaving to: ‘/tmp/u.user’\n\n     0K .......... .......... ..                              100% 89.7K=0.2s\n\n2025-07-13 08:38:12 (89.7 KB/s) - ‘/tmp/u.user’ saved [22628/22628]\n\n--2025-07-13 08:38:12--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.216.9.27, 16.182.97.185, 54.231.196.145, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.216.9.27|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data’\n\n     0K .......... .......... .......... .......... ..........  2%  101K 20s\n    50K .......... .......... .......... .......... ..........  4% 1.12M 10s\n   100K .......... .......... .......... .......... ..........  7%  241K 9s\n   150K .......... .......... .......... .......... ..........  9% 10.9M 7s\n   200K .......... .......... .......... .......... .......... 12%  208K 7s\n   250K .......... .......... .......... .......... .......... 14% 9.54M 6s\n   300K .......... .......... .......... .......... .......... 17%  208K 6s\n   350K .......... .......... .......... .......... .......... 19% 10.5M 5s\n   400K .......... .......... .......... .......... .......... 22% 12.2M 4s\n   450K .......... .......... .......... .......... .......... 24%  194K 5s\n   500K .......... .......... .......... .......... .......... 27% 30.7M 4s\n   550K .......... .......... .......... .......... .......... 29% 70.2M 4s\n   600K .......... .......... .......... .......... .......... 32% 78.9M 3s\n   650K .......... .......... .......... .......... .......... 34%  110M 3s\n   700K .......... .......... .......... .......... .......... 36%  134M 3s\n   750K .......... .......... .......... .......... .......... 39%  206K 3s\n   800K .......... .......... .......... .......... .......... 41% 29.7M 2s\n   850K .......... .......... .......... .......... .......... 44% 18.2M 2s\n   900K .......... .......... .......... .......... .......... 46% 31.9M 2s\n   950K .......... .......... .......... .......... .......... 49%  152M 2s\n  1000K .......... .......... .......... .......... .......... 51% 11.7M 2s\n  1050K .......... .......... .......... .......... .......... 54%  216K 2s\n  1100K .......... .......... .......... .......... .......... 56% 12.0M 2s\n  1150K .......... .......... .......... .......... .......... 59% 11.0M 1s\n  1200K .......... .......... .......... .......... .......... 61% 10.8M 1s\n  1250K .......... .......... .......... .......... .......... 64% 11.9M 1s\n  1300K .......... .......... .......... .......... .......... 66%  199K 1s\n  1350K .......... .......... .......... .......... .......... 68%  129M 1s\n  1400K .......... .......... .......... .......... .......... 71% 66.3M 1s\n  1450K .......... .......... .......... .......... .......... 73% 38.5M 1s\n  1500K .......... .......... .......... .......... .......... 76%  380M 1s\n  1550K .......... .......... .......... .......... .......... 78% 56.0M 1s\n  1600K .......... .......... .......... .......... .......... 81% 18.8M 1s\n  1650K .......... .......... .......... .......... .......... 83% 96.3M 0s\n  1700K .......... .......... .......... .......... .......... 86%  227K 0s\n  1750K .......... .......... .......... .......... .......... 88% 7.53M 0s\n  1800K .......... .......... .......... .......... .......... 91% 7.07M 0s\n  1850K .......... .......... .......... .......... .......... 93% 7.61M 0s\n  1900K .......... .......... .......... .......... .......... 96% 11.7M 0s\n  1950K .......... .......... .......... .......... .......... 98%  225K 0s\n  2000K .......... .......... ..........                      100% 5.62M=2.7s\n\n2025-07-13 08:38:15 (742 KB/s) - ‘/tmp/u.data’ saved [2079229/2079229]\n\n--2025-07-13 08:38:15--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 3.5.25.72, 16.182.72.17, 3.5.8.117, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|3.5.25.72|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item’\n\n     0K .......... .......... .......... .......... .......... 21% 98.4K 2s\n    50K .......... .......... .......... .......... .......... 43%  208K 1s\n   100K .......... .......... .......... .......... .......... 64% 10.6M 0s\n   150K .......... .......... .......... .......... .......... 86% 11.2M 0s\n   200K .......... .......... ..........                      100%  131K=1.0s\n\n2025-07-13 08:38:17 (233 KB/s) - ‘/tmp/u.item’ saved [236344/236344]\n\nDownloaded ml-100k dataset!\n"}]},"apps":[],"jobName":"paragraph_1752396619308_-1242408670","id":"20250601-074731_1685467887","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:444"},{"text":"%md\n### Create a new directory and add file to HDFS","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create a new directory and add file to HDFS</h3>\n"}]},"apps":[],"jobName":"paragraph_1752396619308_-1242408670","id":"20250601-100007_453821859","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:445"},{"text":"%sh\nhadoop fs -mkdir /tmp/ml-100k/","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1752396619309_-1242793419","id":"20250601-081428_1652930466","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:446"},{"text":"%sh\nhadoop fs -put /tmp/u.user /tmp/ml-100k/\nhadoop fs -put /tmp/u.data /tmp/ml-100k/\nhadoop fs -put /tmp/u.item /tmp/ml-100k/","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"INCOMPLETE","msg":[{"type":"TEXT","data":"Paragraph received a SIGTERM\nExitValue: 143"}]},"apps":[],"jobName":"paragraph_1752396619309_-1242793419","id":"20250601-075032_970300856","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:447"},{"text":"%md\n\n####  Created Tables in Cassandra\n\n```{shell}\nCREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n```","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Created Tables in Cassandra</h4>\n<pre><code class=\"{shell}\">CREATE TABLE ratings (\n  user_id int,\n  movieid int,\n  rating int,\n  PRIMARY KEY (user_id, movieid)\n);\n\nCREATE TABLE titles (\n  movieid int PRIMARY KEY,\n  title text,\n  unknown int,\n  action int,\n  adventure int,\n  animation int,\n  children int,\n  comedy int,\n  crime int,\n  documentary int,\n  drama int,\n  fantasy int,\n  filmnoir int,\n  horror int,\n  musical int,\n  mystery int,\n  romance int,\n  scifi int,\n  thriller int,\n  war int,\n  western int\n);\n\nCREATE TABLE users (\n  user_id int, \n  age int, \n  gender text, \n  occupation text, \n  zip text,\nPRIMARY KEY (user_id)\n);\n</code></pre>\n"}]},"apps":[],"jobName":"paragraph_1752396619309_-1242793419","id":"20250616-122251_1937518947","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:448"},{"text":"%md\n### Create RDD for Spark analysis and DataFrame","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Create RDD for Spark analysis and DataFrame</h3>\n"}]},"apps":[],"jobName":"paragraph_1752396619310_-1241639172","id":"20250601-100040_999974092","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:449"},{"text":"print(spark.version)","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2.3.0.2.6.5.0-292"}]},"apps":[],"jobName":"paragraph_1752396619310_-1241639172","id":"20250616-082512_1958268214","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:450"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# ParseInput function\r\ndef parseInput(line):\r\n    fields = line.split('|')\r\n    return Row(user_id=int(fields[0]), age=int(fields[1]), gender=fields[2], occupation=fields[3], zip=fields[4])\r\n\r\n# Load raw user data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.user\")\r\n\r\n# Apply transformation\r\nusers = lines.map(parseInput)\r\n\r\n# Create DataFrame\r\nusersDataset = spark.createDataFrame(users)\r\n\r\n# Write to Cassandra\r\nusersDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadUsers = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"users\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\nreadUsers.show()","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|    636| 47|     M|  educator|48043|\n|    896| 28|     M|    writer|91505|\n|    757| 26|     M|   student|55104|\n|    532| 20|     M|   student|92705|\n|    846| 27|     M|    lawyer|47130|\n|    613| 37|     F| marketing|29678|\n|    690| 35|     M|  salesman|63304|\n|    906| 45|     M| librarian|70124|\n|    566| 20|     M|   student|14627|\n|    488| 48|     M|technician|21012|\n|    150| 20|     F|    artist|02139|\n|    413| 55|     M|  educator|78212|\n|    826| 28|     M|    artist|77048|\n|    281| 15|     F|   student|06059|\n|     85| 51|     M|  educator|20003|\n|    554| 32|     M| scientist|62901|\n|    207| 39|     M| marketing|92037|\n|    100| 36|     M| executive|90254|\n|    502| 22|     M|   student|23092|\n|    464| 60|     M|    writer|94583|\n+-------+---+------+----------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1752396619310_-1241639172","id":"20250601-075141_186696073","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:451"},{"text":"%md\n#### Create Ratings RDD and DataFrame","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Create Ratings RDD and DataFrame</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619310_-1241639172","id":"20250601-100352_1386531563","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:452"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse each line into (user_id, movieid, rating)\r\ndef parseInput2(line):\r\n    fields = line.split('\\t')\r\n    return Row(user_id=int(fields[0]), movieid=int(fields[1]), rating=int(fields[2]))\r\n\r\n# Load ratings data from HDFS\r\nlines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.data\")\r\n\r\n# Map lines to Rows\r\nratings = lines.map(parseInput2)\r\n\r\n# Create DataFrame from ratings\r\nratingsDataset = spark.createDataFrame(ratings)\r\n\r\n# Write to Cassandra\r\nratingsDataset.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadRatings = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"ratings\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show the result\r\nreadRatings.show()\r\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------+------+\n|user_id|movieid|rating|\n+-------+-------+------+\n|    636|      1|     3|\n|    636|      9|     3|\n|    636|     10|     5|\n|    636|     15|     5|\n|    636|     25|     5|\n|    636|    100|     5|\n|    636|    106|     4|\n|    636|    118|     5|\n|    636|    121|     5|\n|    636|    222|     5|\n|    636|    235|     4|\n|    636|    258|     5|\n|    636|    272|     5|\n|    636|    275|     3|\n|    636|    283|     3|\n|    636|    313|     5|\n|    636|    596|     5|\n|    636|    740|     4|\n|    636|    760|     5|\n|    636|    813|     5|\n+-------+-------+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1752396619311_-1242023921","id":"20250601-075951_343576443","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:453"},{"text":"%md\n#### Create Movie RDD and DataFrame","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Create Movie RDD and DataFrame</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619311_-1242023921","id":"20250601-100414_1092910371","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:454"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql import Row\r\nfrom pyspark.sql import functions as F\r\n\r\n# Parse movie lines\r\ndef parse_movie(line):\r\n    fields = line.split('|')\r\n    return Row(\r\n        movieid=int(fields[0]),\r\n        title=fields[1],\r\n        unknown=int(fields[5]),\r\n        action=int(fields[6]),\r\n        adventure=int(fields[7]),\r\n        animation=int(fields[8]),\r\n        children=int(fields[9]),\r\n        comedy=int(fields[10]),\r\n        crime=int(fields[11]),\r\n        documentary=int(fields[12]),\r\n        drama=int(fields[13]),\r\n        fantasy=int(fields[14]),\r\n        filmnoir=int(fields[15]),\r\n        horror=int(fields[16]),\r\n        musical=int(fields[17]),\r\n        mystery=int(fields[18]),\r\n        romance=int(fields[19]),\r\n        scifi=int(fields[20]),\r\n        thriller=int(fields[21]),\r\n        war=int(fields[22]),\r\n        western=int(fields[23])\r\n    )\r\n\r\n# Load raw movie data from HDFS\r\nmovie_lines = spark.sparkContext.textFile(\"hdfs:///tmp/ml-100k/u.item\")\r\n\r\n# Apply parsing\r\nmovies = movie_lines.map(parse_movie)\r\n\r\n# Convert to DataFrame\r\nmovies_df = spark.createDataFrame(movies)\r\n\r\n# Write to Cassandra\r\nmovies_df.write \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .mode(\"append\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .save()\r\n\r\n# Read back from Cassandra\r\nreadMovies = spark.read \\\r\n    .format(\"org.apache.spark.sql.cassandra\") \\\r\n    .options(table=\"titles\", keyspace=\"movielens\") \\\r\n    .load()\r\n\r\n# Show result\r\nreadMovies.show()\r\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|movieid|action|adventure|animation|children|comedy|crime|documentary|drama|fantasy|filmnoir|horror|musical|mystery|romance|scifi|thriller|               title|unknown|war|western|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\n|    636|     1|        1|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    1|       1|Escape from New Y...|      0|  0|      0|\n|   1110|     1|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      1|      0|      0|    1|       0|    Tank Girl (1995)|      0|  0|      0|\n|   1225|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|        Angus (1995)|      0|  0|      0|\n|   1324|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       1|       Loaded (1994)|      0|  0|      0|\n|    896|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Sweet Hereafter, ...|      0|  0|      0|\n|    757|     0|        0|        0|       0|     0|    0|          1|    0|      0|       0|     0|      0|      0|      0|    0|       0|Across the Sea of...|      0|  0|      0|\n|   1117|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Surviving Picasso...|      0|  0|      0|\n|    532|     0|        0|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      1|    0|       0|Kama Sutra: A Tal...|      0|  0|      0|\n|   1080|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Celestial Clockwo...|      0|  0|      0|\n|    846|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      1|    0|       0|To Gillian on Her...|      0|  0|      0|\n|   1352|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Shadow of Angels ...|      0|  0|      0|\n|    613|     0|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|My Man Godfrey (1...|      0|  0|      0|\n|    690|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|Seven Years in Ti...|      0|  1|      0|\n|    906|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      1|    0|       0|Oscar & Lucinda (...|      0|  0|      0|\n|   1335|     0|        0|        0|       0|     0|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|American Buffalo ...|      0|  0|      0|\n|    566|     1|        1|        0|       0|     0|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       1|Clear and Present...|      0|  0|      0|\n|    488|     0|        0|        0|       0|     0|    0|          0|    0|      0|       1|     0|      0|      0|      0|    0|       0| Sunset Blvd. (1950)|      0|  0|      0|\n|   1183|     1|        0|        0|       0|     1|    0|          0|    0|      0|       0|     0|      0|      0|      0|    0|       0|Cowboy Way, The (...|      0|  0|      0|\n|    150|     0|        0|        0|       0|     1|    0|          0|    1|      0|       0|     0|      0|      0|      0|    0|       0|     Swingers (1996)|      0|  0|      0|\n|    413|     0|        0|        0|       0|     0|    0|          0|    0|      0|       0|     1|      0|      0|      0|    0|       0|Tales from the Cr...|      0|  0|      0|\n+-------+------+---------+---------+--------+------+-----+-----------+-----+-------+--------+------+-------+-------+-------+-----+--------+--------------------+-------+---+-------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1752396619311_-1242023921","id":"20250601-080143_442481103","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:455"},{"text":"%md\n## Question \n\n#### 1) Calculate the average rating for each movie.","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>Question</h2>\n<h4>1) Calculate the average rating for each movie.</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619311_-1242023921","id":"20250601-074655_1233757886","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:456"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import avg\r\n\r\n# Join ratings and movie metadata on movieid\r\njoined_df = readRatings.join(readMovies, on=\"movieid\")\r\n\r\n# Group by title and compute average rating\r\navg_ratings_df = joined_df.groupBy(\"title\").agg(avg(\"rating\").alias(\"avg_rating\"))\r\n\r\n# Order by average rating descending and get top 20\r\ntop_20_movies = avg_ratings_df.orderBy(\"avg_rating\", ascending=False).limit(20)\r\n\r\n# Show the result\r\ntop_20_movies.show()\r\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----------------+\n|               title|       avg_rating|\n+--------------------+-----------------+\n|Santa with Muscle...|              5.0|\n|Marlene Dietrich:...|              5.0|\n|Someone Else's Am...|              5.0|\n|Aiqing wansui (1994)|              5.0|\n|Saint of Fort Was...|              5.0|\n|     Star Kid (1997)|              5.0|\n|Great Day in Harl...|              5.0|\n|Entertaining Ange...|              5.0|\n|They Made Me a Cr...|              5.0|\n|  Prefontaine (1997)|              5.0|\n|Pather Panchali (...|            4.625|\n|Maya Lin: A Stron...|              4.5|\n|         Anna (1996)|              4.5|\n|      Everest (1998)|              4.5|\n|Some Mother's Son...|              4.5|\n|Close Shave, A (1...|4.491071428571429|\n|Schindler's List ...|4.466442953020135|\n|Wrong Trousers, T...|4.466101694915254|\n|   Casablanca (1942)| 4.45679012345679|\n|Wallace & Gromit:...|4.447761194029851|\n+--------------------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1752396619311_-1242023921","id":"20250601-075851_486488278","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:457"},{"text":"%md\n#### 2) Identify the top ten movies with the highest average ratings.\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>2) Identify the top ten movies with the highest average ratings.</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619312_-1231635700","id":"20250713-084228_1049231060","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:458"},{"text":"%pyspark\n\ntop_20_movies.limit(10).show()\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+\n|               title|avg_rating|\n+--------------------+----------+\n|Aiqing wansui (1994)|       5.0|\n|They Made Me a Cr...|       5.0|\n|Great Day in Harl...|       5.0|\n|Entertaining Ange...|       5.0|\n|     Star Kid (1997)|       5.0|\n|Someone Else's Am...|       5.0|\n|Marlene Dietrich:...|       5.0|\n|Saint of Fort Was...|       5.0|\n|Santa with Muscle...|       5.0|\n|  Prefontaine (1997)|       5.0|\n+--------------------+----------+\n\n"}]},"apps":[],"jobName":"paragraph_1752396619312_-1231635700","id":"20250601-084016_851685417","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:459"},{"text":"%md\n#### 3) Find the users who have rated at least 50 movies and identify their favourite movie genres.","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>3) Find the users who have rated at least 50 movies and identify their favourite movie genres.</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619312_-1231635700","id":"20250713-084245_1725828158","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:460"},{"text":"%pyspark\r\n\r\nfrom pyspark.sql.functions import col, count, row_number\r\nfrom pyspark.sql.window import Window\r\n\r\n# Filter users who rated at least 50 movies\r\nfiltered_users = readRatings.groupBy(\"user_id\") \\\r\n    .agg(count(\"*\").alias(\"num_ratings\")) \\\r\n    .filter(col(\"num_ratings\") >= 50) \\\r\n    .select(\"user_id\")\r\n\r\n# Join ratings with filtered users and titles\r\nfiltered_ratings = readRatings \\\r\n    .join(filtered_users, on=\"user_id\") \\\r\n    .join(readMovies, on=\"movieid\")\r\n\r\n# Unpivot genre columns\r\ngenre_columns = [\r\n    \"unknown\", \"action\", \"adventure\", \"animation\", \"children\", \"comedy\", \"crime\",\r\n    \"documentary\", \"drama\", \"fantasy\", \"filmNoir\", \"horror\", \"musical\", \"mystery\",\r\n    \"romance\", \"sciFi\", \"thriller\", \"war\", \"western\"\r\n]\r\n\r\n# Flatten genres (manual unpivot via union)\r\nuser_genres = None\r\nfor genre in genre_columns:\r\n    temp = filtered_ratings.filter(col(genre) == 1) \\\r\n        .select(\"user_id\").withColumn(\"genre\", F.lit(genre))\r\n    user_genres = temp if user_genres is None else user_genres.union(temp)\r\n\r\n# Count genre frequencies per user\r\nuser_genre_counts = user_genres.groupBy(\"user_id\", \"genre\") \\\r\n    .agg(count(\"*\").alias(\"count\"))\r\n\r\n# Rank genres per user\r\nwindowSpec = Window.partitionBy(\"user_id\").orderBy(col(\"count\").desc())\r\n\r\nranked_genres = user_genre_counts.withColumn(\"rank\", row_number().over(windowSpec))\r\n\r\n# Select top genre per user\r\ntop_genres_per_user = ranked_genres.filter(col(\"rank\") == 1) \\\r\n    .orderBy(col(\"count\").desc())\r\n\r\ntop_genres_per_user.select(\"user_id\", \"genre\", \"count\").show()\r\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"editorSetting":{"language":"python"},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true,"setting":{"multiBarChart":{}},"commonSetting":{},"keys":[{"name":"genre","index":1,"aggr":"sum"}],"groups":[],"values":[{"name":"genre","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+-----+\n|user_id| genre|count|\n+-------+------+-----+\n|    655| drama|  410|\n|    405| drama|  309|\n|    537| drama|  251|\n|    450| drama|  237|\n|     13| drama|  218|\n|    234| drama|  213|\n|    416| drama|  212|\n|    279|comedy|  211|\n|    201| drama|  196|\n|    393|comedy|  191|\n|    181| drama|  188|\n|    303|comedy|  184|\n|    334| drama|  174|\n|     90| drama|  173|\n|    378| drama|  170|\n|    276| drama|  168|\n|    429| drama|  167|\n|    474| drama|  166|\n|    293| drama|  165|\n|    308| drama|  163|\n+-------+------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1752396619312_-1231635700","id":"20250601-153933_1772289805","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:461"},{"text":"%md\n#### 4) Find all the users who are less than 20 years old.","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>4) Find all the users who are less than 20 years old.</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619313_-1232020449","id":"20250601-074805_626279176","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:462"},{"text":"%pyspark\n\nyoung = readUsers.filter(\"age < 20\")\n\nyoung.show()\n","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+-------------+-----+\n|user_id|age|gender|   occupation|  zip|\n+-------+---+------+-------------+-----+\n|    281| 15|     F|      student|06059|\n|     36| 19|     F|      student|93117|\n|    347| 18|     M|      student|90210|\n|     68| 19|     M|      student|22904|\n|    341| 17|     F|      student|44405|\n|    179| 15|     M|entertainment|20755|\n|    620| 18|     F|       writer|81648|\n|    863| 17|     M|      student|60089|\n|    904| 17|     F|      student|61073|\n|    291| 19|     M|      student|44106|\n|     57| 16|     M|         none|84010|\n|    609| 13|     F|      student|55106|\n|    621| 17|     M|      student|60402|\n|    887| 14|     F|      student|27249|\n|    270| 18|     F|      student|63119|\n|    761| 17|     M|      student|97302|\n|    258| 19|     F|      student|77801|\n|    367| 17|     M|      student|37411|\n|    206| 14|     F|      student|53115|\n|    142| 13|     M|        other|48118|\n+-------+---+------+-------------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1752396619313_-1232020449","id":"20250601-095246_369636275","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:463"},{"text":"%md\n#### 5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.","dateUpdated":"2025-07-13T08:50:40+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>5) Find all the users whose occupation is “scientist” and whose age is between 30 and 40 years old.</h4>\n"}]},"apps":[],"jobName":"paragraph_1752396619314_-1230866203","id":"20250601-074819_1245780377","dateCreated":"2025-07-13T08:50:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:464","user":"anonymous","dateFinished":"2025-07-13T08:50:40+0000","dateStarted":"2025-07-13T08:50:40+0000"},{"text":"%pyspark\n\nscientist3040 = readUsers.filter(\n    (col(\"age\") > 29) & (col(\"age\") < 41) & (col(\"occupation\") == \"scientist\"))\n    \nscientist3040.show()","dateUpdated":"2025-07-13T08:50:19+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|    554| 32|     M| scientist|62901|\n|     40| 38|     M| scientist|27514|\n|     71| 39|     M| scientist|98034|\n|    874| 36|     M| scientist|37076|\n|    538| 31|     M| scientist|21010|\n|    730| 31|     F| scientist|32114|\n|     74| 39|     M| scientist|T8H1N|\n|    183| 33|     M| scientist|27708|\n|    107| 39|     M| scientist|60466|\n|    918| 40|     M| scientist|70116|\n|    337| 37|     M| scientist|10522|\n|    272| 33|     M| scientist|53706|\n|    430| 38|     M| scientist|98199|\n|    643| 39|     M| scientist|55122|\n|    543| 33|     M| scientist|95123|\n|    309| 40|     M| scientist|70802|\n+-------+---+------+----------+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1752396619314_-1230866203","id":"20250601-074853_95309685","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:465"},{"dateUpdated":"2025-07-13T08:50:19+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1752396619314_-1230866203","id":"20250601-095645_1372081403","dateCreated":"2025-07-13T08:50:19+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:466"}],"name":"Project3_P153944","id":"2M2DEQ51C","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}